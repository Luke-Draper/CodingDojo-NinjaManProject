<html>
	<head>
		<title>Ninja-Man</title>
		<style type="text/css">
			* {
				margin: 0;
				padding: 0;
				line-height: 0;
			}
			.tile {
				height: 40px;
				width: 40px;
				display: inline-block;
			}
			.init {
				background-color: purple;
			}
			.wall {
				background-color: darkslategray;
			}
			.onigiri {
				background-color: white;
				background-image: url("img/onigiri.png");
				background-size: contain;
			}
			.sushi {
				background-color: white;
				background-image: url("img/sushi.png");
				background-size: contain;
			}
			.blank {
				background-color: white;
			}
			#ninja-man {
				background-image: url("img/ninja.gif");
				background-size: contain;
				position: absolute;
				top: 40px;
				left: 40px;
			}
			#red {
				background-color: white;
				background-image: url("img/red.gif");
				background-size: contain;
				position: absolute;
				top: 40px;
				left: 40px;
			}
			#pumpky {
				background-color: white;
				background-image: url("img/pumpky.gif");
				background-size: contain;
				position: absolute;
				top: 40px;
				left: 40px;
			}
			#pinky {
				background-color: white;
				background-image: url("img/pinky.gif");
				background-size: contain;
				position: absolute;
				top: 40px;
				left: 40px;
			}
			#bluey {
				background-color: white;
				background-image: url("img/bluey.gif");
				background-size: contain;
				position: absolute;
				top: 40px;
				left: 40px;
			}
		</style>
	</head>
	<body>
		<div id="grid"></div>
		<div id="ninja-man" class="tile"></div>
		<script type="text/javascript">
			
			var gridArray = [];
			var gridEnum = { // More expressive code when declaring types
				init: 1,
				blank: 2,
				wall: 3,
				onigiri: 4,
				sushi: 5
			}
			var gridDict = {
				1: 'init',
				2: 'blank',
				3: 'wall',
				4: 'onigiri',
				5: 'sushi'
			}
			var ninjaMan = {
				x: 0,
				y: 0,
				score: 0,
				invulnerable: false,
				flashCount: 0, //whether he is visible after being hit during invulnerability
				livesRemaining: 3,
				sushiPower: false,
				sushiPowerTimeRemaining: 0
			}
			const TILE_SIZE = 40;
			const GRID_WIDTH = 12, GRID_HEIGHT = 12; // These values do not include the exterior walls of the grid
			const GAME_TICK_TIME = 600;
			const SUSHI_POWER_TIME = 40;
			const SUSHI_SCORE = 20, ONIGIRI_SCORE = 5;

			function initializeGrid() {
				for (var y=0; y<GRID_HEIGHT; y++) {
					var rowArray = [];
					for (var x=0; x<GRID_WIDTH; x++) {
						rowArray.push(gridEnum.blank);
					}
					gridArray.push(rowArray);
				}
			}
			
			function randomizeGrid() {

			}

			function drawWorld() {
				var gridContent = "";
				//Add Top Wall
				gridContent += "<div class='row'>";
				for (var temp=0; temp<GRID_WIDTH+2; temp++) {
					gridContent += "<div class='tile wall'></div>";
				}
				//Add Array Content
				gridContent += "</div>";
				for (var row=0; row<GRID_HEIGHT; row++) {
					gridContent += "<div class='row'><div class='tile wall'></div>";
					for (var col=0; col<GRID_WIDTH; col++) {
						gridContent += ("<div class='tile " + gridDict[gridArray[row][col]] + "'></div>");
					}
					gridContent += "<div class='tile wall'></div></div>";
				}
				//Add Bottom Wall
				gridContent += "<div class='row'>";
				for (var temp=0; temp<GRID_WIDTH+2; temp++) {
					gridContent += "<div class='tile wall'></div>";
				}
				gridContent += "</div>";
				document.getElementById('grid').innerHTML = gridContent;
			}


			function updateNinjaMan() {
				document.getElementById("ninja-man").style.left = (ninjaMan.x + 1) * TILE_SIZE + "px";
				document.getElementById("ninja-man").style.top = (ninjaMan.y + 1) * TILE_SIZE + "px";
			}
			
			function moveNinjaMan(xMove,yMove) {
				if (ninjaMan.y + yMove < 0 || ninjaMan.y + yMove >= GRID_HEIGHT || ninjaMan.x + xMove < 0 || ninjaMan.x + xMove >= GRID_WIDTH) {
					return; //Prevent moving off the board
				}
				if (gridArray[ninjaMan.y + yMove][ninjaMan.x + xMove] == gridEnum.blank) {
					ninjaMan.x += xMove;
					ninjaMan.y += yMove;
					updateNinjaMan();
				} else if (gridArray[ninjaMan.y + yMove][ninjaMan.x + xMove] == gridEnum.sushi) {
					gridArray[ninjaMan.y + yMove][ninjaMan.x + xMove] = gridEnum.blank;
					drawWorld();
					ninjaMan.x += xMove;
					ninjaMan.y += yMove;
					ninjaMan.score += SUSHI_SCORE;
					updateNinjaMan();
					console.log(ninjaMan.score);
				} else if (gridArray[ninjaMan.y + yMove][ninjaMan.x + xMove] == gridEnum.onigiri) {
					gridArray[ninjaMan.y + yMove][ninjaMan.x + xMove] = gridEnum.blank;
					drawWorld();
					ninjaMan.x += xMove;
					ninjaMan.y += yMove;
					ninjaMan.score += ONIGIRI_SCORE;
					updateNinjaMan();
					console.log(ninjaMan.score);
				}
			}

			document.onkeydown = function(e){
				if(e.keyCode == 37) { // LEFT
					moveNinjaMan(-1,0);
				}
				else if (e.keyCode == 39) { // RIGHT
					moveNinjaMan(1,0);
				}
				else if (e.keyCode == 38) { // UP
					moveNinjaMan(0,-1);
				}
				else if (e.keyCode == 40) { // DOWN
					moveNinjaMan(0,1);
				}
			}
			initializeGrid();
			drawWorld();
		</script>
	</body>
</html>